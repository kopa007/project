{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Dashboard</h2>

<div class="summary">
    <p><strong>Total Income:</strong> ${{ income }}</p>
    <p><strong>Total Expenses:</strong> ${{ expense }}</p>
    <p><strong>Balance:</strong> ${{ balance }}</p>
</div>

<a href="/add">Add New Transaction</a>

<h3>Transactions</h3>
<table border="1">
    <thead>
        <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        {% for t in transactions %}
        <tr>
            <td>{{ t.date }}</td>
            <td>{{ t.category }}</td>
            <td>{{ t.type }}</td>
            <td>${{ t.amount }}</td>
            <td>{{ t.description }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Example chart -->
<canvas id="expenseChart" width="400" height="200"></canvas>
<script>
const transactions = {{ transactions|tojson }};
const categoryNames = [];
const categoryAmounts = [];
const totals = {};

transactions.forEach(t => {
    if (t.type === "expense") {
        if (!totals[t.category]) totals[t.category] = 0;
        totals[t.category] += t.amount;
    }
});

for (const [cat, amt] of Object.entries(totals)) {
    categoryNames.push(cat);
    categoryAmounts.push(amt);
}

const ctx = document.getElementById("expenseChart").getContext("2d");
new Chart(ctx, {
    type: "bar",
    data: {
        labels: categoryNames,
        datasets: [{
            label: "Expenses by Category",
            data: categoryAmounts,
            backgroundColor: "rgba(75, 192, 192, 0.6)",
            borderColor: "rgba(75, 192, 192, 1)",
            borderWidth: 1
        }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
});
</script>
{% endblock %}
